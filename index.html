<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cattle Analysis Result</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!-- Loader Overlay -->
  <div id="overlay">
    <div class="loader"></div>
    <p class="loading-text">Analyzing cow image, please wait...</p>
  </div>

  <div class="container py-5">

    <!-- Language Selector -->
    <div class="choose-lang-box mb-4 shadow-sm">
      <strong>ğŸŒ Language:</strong>
      <select id="lang" name="language">
        <option value="en">English</option>
        <option value="ta">Tamil</option>
        <option value="hi">Hindi</option>
        <option value="kn">Kannada</option>
      </select>
    </div>

    <!-- Upload Section -->
    <div class="card-modern mb-4">
      <h4 class="section-title text-center mb-3">ğŸ“¤ Upload Cow Image</h4>
      <div class="row">
        <div class="col-lg-6">
          <input type="file" id="fileInput1" accept="image/*" class="form-control mb-3 shadow-sm">
          <img id="preview1" src="#" alt="Preview" class="img-fluid shadow-sm">
          <h5 class="text-center p-2">Cow Full Image with Person</h5>
        </div>
        <div class="col-lg-6">
          <input type="file" id="fileInput2" accept="image/*" class="form-control mb-3 shadow-sm">
          <img id="preview2" src="#" alt="Preview" class="img-fluid shadow-sm">
            <h5 class="text-center p-2">Cow Head</h5>
        </div>
      </div>

      <input type="text" id="height" class="form-control mt-3 shadow-sm"
        placeholder="Enter Person Height (in cm)">
      <button class="btn btn-primary w-100 mt-3" onclick="uploadImage()">ğŸ” Analyze</button>
    </div>

    <!-- Results Section -->
    <div class="card-modern shadow-sm">
      <h4 class="section-title text-center">ğŸ“Š Analysis Result</h4>
      <div id="result" class="mt-3">
          <img id="serverimage1" src="" alt="Uploaded Cow" class="img-fluid mt-3" style="display:none; max-width:400px; border-radius:10px;"/>

      </div>
    </div>

  </div>

  <script>
    const fileInput1 = document.getElementById('fileInput1');
    const fileInput2 = document.getElementById('fileInput2');
    const heightInput = document.getElementById('height');
    const preview1 = document.getElementById('preview1');
    const preview2 = document.getElementById('preview2');
    const resultDiv = document.getElementById('result');
    const lang = document.getElementById('lang');

    const serverimage1 = document.getElementById("serverimage1");

    fileInput1.addEventListener('change', () => {
      const file = fileInput1.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        preview1.style.display = "block";
        preview1.src = reader.result;
      };
      if (file) reader.readAsDataURL(file);
    });
    fileInput2.addEventListener('change', () => {
      const file = fileInput2.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        preview2.style.display = "block";
        preview2.src = reader.result;
      };
      if (file) reader.readAsDataURL(file);
    });

    function uploadImage() {
      document.getElementById("overlay").style.display = "flex";

      const file = fileInput1.files[0];
      const cowface = fileInput2.files[0];
      if (!file || !cowface) return alert("Please select an image.");

      let formData = new FormData();
      formData.append("image", file);
      formData.append("cowface", cowface);
      formData.append("person_height", heightInput.value);
      formData.append("lang", lang.value);
// https://creedal-dayton-monarchistic.ngrok-free.dev/upload
//http://127.0.0.1:8080/upload
      fetch("https://creedal-dayton-monarchistic.ngrok-free.dev/upload", {
        method: "POST",
        body: formData
      })
        .then(res => res.json())
        .then(data => {
          // console.log(data)
          let items = "";
          data.diagnosis_report.report.forEach((item) => {
            items += `
              <div class='pt-3'>
                <strong>Label:</strong> ${item.label || "Unavailable"} <br>
                <strong>Confidence:</strong> ${item.confidence || "Unavailable"} 
                <div class="text-start">
                  <img src="data:image/jpeg;base64,${item.annotated_image_base64}" class="img-fluid shadow-sm mb-3" style="display:block; border-radius:10px; max-width:400px;" alt="No Anotation" />
                </div>
                <div class="ai-box">${item.ai_recommendations || "No recommendations available"}</div>
              </div>`;
          }); 
          resultDiv.innerHTML = `
            <div class="result-box"> 
              <div class='row'>
                <div class="col-lg-6">
                   <img src="data:image/jpeg;base64,${data.cow_image_base64}" class="img-fluid shadow-sm mb-3" style="display:block; border-radius:10px; max-width:400px; margin:auto;" alt="Cow Image" />
                </div>
                <div class="col-lg-6">
                   <img src="data:image/jpeg;base64,${data.cow_face_base64}" class="img-fluid shadow-sm mb-3" style="display:block; border-radius:10px; max-width:400px; margin:auto;" alt="Cow Image" />
                </div>
              </div>
              <p><strong>âš ï¸ Warning:</strong> ${data.warning || "No Warning"}</p>
              <p><strong>ğŸ„ Cow Found:</strong> ${data.cow_found ? "âœ… Yes" : "âŒ No"}</p>
              <p><strong>ğŸ® Breed:</strong> ${data.cow_breed}</p>
              <p><strong>âš–ï¸ Estimated Weight:</strong> ${data.estimated_approximate_weight || "Not Available"}</p>
              <p><strong>ğŸ©º Udder Found:</strong> ${data.udder_found ? "âœ… Yes" : "âŒ No"}</p>
              <p><strong>ğŸ¥› Milk Yield:</strong> ${data.milk_yield || "Not Available"}</p>
            </div>
            <h5 class="mt-4 text-primary fw-semibold">ğŸ§ª Diagnosis Summary</h5>
            ${items}
          `;
        }).catch((e)=>{
          console.log(e)
            alert("Call Tamil to Retify")
        })
        .finally(() => {
           preview2.src = ""
           preview1.src = ""
           fileInput1.src = ""
           fileInput2.src = ""
          document.getElementById("overlay").style.display = "none";
        });
    }
  </script>
</body>

</html>
